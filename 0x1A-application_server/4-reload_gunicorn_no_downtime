#!/usr/bin/env bash

# Set the path to the Gunicorn executable
GUNICORN_EXECUTABLE="/home/ubuntu/AirBnB_clone_v2/bin/gunicorn"

# Set the path to the Gunicorn application
GUNICORN_APP="/path/to/your/app:app"

# Get the process IDs of Gunicorn
gunicorn_pids=$(pgrep -f "$GUNICORN_APP")

if [ -z "$gunicorn_pids" ]; then
    echo "No Gunicorn processes found for $GUNICORN_APP."
    exit 1
fi

# Display the current Gunicorn processes
echo "Current Gunicorn processes:"
ps auxf | grep "$GUNICORN_APP"

# Gracefully reload Gunicorn by sending a HUP signal to each process
echo "Reloading Gunicorn gracefully..."
for pid in $gunicorn_pids; do
    kill -HUP $pid
done

# Wait for a few seconds to allow workers to finish processing requests
echo "Waiting for workers to finish processing requests..."
sleep 5

# Display the updated Gunicorn processes
echo "Updated Gunicorn processes:"
ps auxf | grep "$GUNICORN_APP"

echo "Gunicorn reloaded successfully."

